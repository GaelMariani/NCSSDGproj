---
title: "Part_1"
author: "Gael Mariani"
date: "`r Sys.Date()`"
output: 
  html_document:
    keep_md: true
---

```{r setup, include=FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE)
devtools::load_all()
```

## Relationships between NCS implementation and SDG achievement

```{r message = FALSE}
raw_dat <- NCSSDGproj::read_matrix()

pathSDG <- NCSSDGproj::load_SDG_icon()
pathNCS <- NCSSDGproj::load_NCS_icon()

icon_SDG <- NCSSDGproj::format_icons(pathSDG, icon_SDG = TRUE)
icon_NCS <- NCSSDGproj::format_icons(pathNCS, icon_SDG = FALSE)

data_long <- NCSSDGproj::matrix_to_longDF(matrix01 = raw_dat)
SDG_matrix <- NCSSDGproj::matrix_SDG(data_long = data_long)
SDG_net <- NCSSDGproj::matrix_to_network(matrix = SDG_matrix, mode1 = "P" , mode2 = "A")

NCSSDGproj::plot_network(SDG_net, SDG_matrix,
                         icon_SDG = icon_SDG,icon_NCS = icon_NCS,
                         nodes_col = c(rep("#66c2a5", 4), rep("#e5c494", 4), rep("#8da0cb", 3)),
                         save = TRUE)

data_pour <- NCSSDGproj::perc_SDG(data_long = data_long)

NCSSDGproj::barplot_percSDG(data_plot = data_pour, save = TRUE, legend = TRUE)

Fig1 <- NCSSDGproj::Figure1(save = TRUE)

```

## Target Insurance and null models

```{r message=FALSE, warning=FALSE}

matrix01 <- NCSSDGproj::contingency_mat_targets(raw_dat)

mod_nest_res <- NCSSDGproj::NullModels(matrix01 = matrix01, rawdata = raw_dat, NMalgo = "quasiswap", NESTmethod = "NODF",
                                       Nrun = 5, Nsim = 5, TargetInsurance = FALSE)

TUI_TOI_res <- NCSSDGproj::NullModels(matrix01 = matrix01, rawdata = raw_dat, NMalgo = "r00", NESTmethod = "NODF",
                                      Nrun = 100, Nsim = 100, TargetInsurance = TRUE)


data_Insurance <- NCSSDGproj::Insurance_data2plot(matrix01 = matrix01, Ntarget = ncol(matrix01)) 

NCSSDGproj::Insurance_plot(data = data_Insurance, 
                           TI = 5.20, 
                           TUI_obs = round(TUI_TOI_res$Val_Obs[1], 3) * 100, 
                           TUI_null = round(TUI_TOI_res$Val_nulls[1], 4) * 100,
                           obs_col = "#0000EB", 
                           null_col = "#E60000", 
                           save = TRUE) 
```


## Correspondance Analysis (ne marche pas encore)

```{r}

NCS_info <- NCSSDGproj::NCS_info(matrix01)
ca <- NCSSDGproj::Correspondance_Analysis(matrix01 = matrix01)

NCSSDGproj::plot_CorresAna(ca =  ,
                           ca_subset = ,
                           NCS_info = ,
                           colors = ,
                           ellipse = ,
                           hull = , 
                           save = FALSE)

```


## Unipartite network

```{r message = FALSE, warning = FALSE}
 
conting_mat <- NCSSDGproj::contingency_mat_targets(raw_dat = raw_dat)

netw_Unip <- NCSSDGproj::network_uniP(contin_mat_target = conting_mat, 
                                      method = "fruchtermanreingold", 
                                      colNCS_ter = "#66c2a5", 
                                      colNCS_coast = "#e5c494",
                                      colNCS_mar = "#8da0cb", 
                                      colTARG = "grey70")

NCSSDGproj::unipart_plot(netw = netw_Unip, 
                         colNCS_ter = "#66c2a5", 
                         colNCS_coast = "#e5c494", 
                         colNCS_mar = "#8da0cb", 
                         save = TRUE)


```


